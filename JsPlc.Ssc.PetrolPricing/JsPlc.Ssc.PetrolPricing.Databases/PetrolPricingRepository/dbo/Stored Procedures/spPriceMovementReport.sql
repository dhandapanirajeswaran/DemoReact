CREATE PROCEDURE [dbo].[spPriceMovementReport]
	@StartDate DATE,
	@EndDate DATE,
	@SiteIds VARCHAR(MAX)
AS
BEGIN
	SET NOCOUNT ON;

--DEBUG:START
--DECLARE @StartDate DATE = DATEADD(DAY, -30, GETDATE())
--DECLARE @EndDate DATE = DATEADD(DAY, -1, GETDATE())
--DECLARE @SiteIds VARCHAR(MAX) = '9,13,19,21,24,26,53,55,57,58,62,63,64,69,71,73,104,110,113,161,164,167,169,206,207,214,257,265,267,276,304,306,309,314,316,321,325,354,356,364,402,413,414,421,422,424,429,430,431,434,508,509,537,539,542,544,547,591,594,598,600,632,635,645,675,676,698,700,711,733,759,816,818,846,871,902,922,987,990,992,993,995,996,998,1036,1046,1048,1072,1073,1078,1080,1082,1092,1122,1123,1129,1155,1158,1162,1163,1164,1168,1198,1202,1204,1212,1214,1246,1248,1252,1284,1292,1295,1296,1298,1301,1302,1307,1335,1337,1338,1346,1378,1382,1383,1428,1429,1436,1438,1470,1472,1473,1474,1527,1528,1536,1592,1593,1626,1632,1662,1670,1687,1730,1744,1774,1775,1782,1783,1784,1788,1827,1872,1881,1887,1888,1890,1929,1930,1944,1968,2008,2024,2026,2027,2068,2071,2129,2136,2137,2138,2139,2140,2169,2170,2173,2174,2180,2209,2212,2213,2257,2301,2303,2343,2372,2423,2425,2429,2433,2459,2462,2480,2481,2517,2520,2630,2653,2757,2760,2780,2786,2815,2819,2822,2861,2873,2897,2946,2982,3069,3104,3106,3126,3138,3143,3179,3201,3207,3208,3210,3213,3371,3390,3426,3435,3438,3439,3479,3531,3532,3562,3563,3570,3588,3619,3712,3731,3796,3797,3811,3890,3901,3919,3947,3948,3949,3963,4045,4163,4197,4214,4264,4306,4353,4354,4355,4412,4463,4516,4526,4555,4578,4642,4721,4801,4852,4901,4968,4994,4995,5015,5128,5129,5130,5136,5176,5235,5269,5452,5459,5694,5771,5773,5787,5885,5918,5929,6112,6153,6154,6155,6156,6157,6158,6159,6160,6161,6162,6163,6164,6165,6166,6167,6168,6169,6170,6171,6172,6173,6174'
--DEBUG:END

	;WITH DateRange As  
	(  
		SELECT @StartDate AS TheDate
		UNION ALL  
		SELECT DATEADD(DAY,1, TheDate) FROM DateRange
		WHERE TheDate < @EndDate  
	)
	SELECT
		dt.TheDate,
		fp.SiteId,
		fp.FuelTypeId,
		fp.TodayPrice
	FROM
		DateRange dt
		CROSS APPLY dbo.tf_GetHistoricalSiteFuelPricesForDay(dt.TheDate, @SiteIds) fp
END
RETURN 0
