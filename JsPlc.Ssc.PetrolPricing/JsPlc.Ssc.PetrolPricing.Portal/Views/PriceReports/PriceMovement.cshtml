@using System.Web.UI.WebControls
@model JsPlc.Ssc.PetrolPricing.Models.ViewModels.PriceMovementReportContainerViewModel
@{
    if (!Model.FromDate.HasValue)
    {
        Model.FromDate = DateTime.Now;
    }
    if (!Model.ToDate.HasValue)
    {
        Model.ToDate = DateTime.Now;
    }

    var requestedFromDate = @Model.FromDate.Value.Date.ToString("dd-MMM-yyyy");
    var requestedToDate = @Model.ToDate.Value.Date.ToString("dd-MMM-yyyy");
}

<div class="row">
    <div class="col-md-6">
        <h1>Report - Price Movement within selected dates</h1>
    </div>
    <div class="col-md-6 text-right" style="padding-top: 20px">
        @if (Model.FuelTypeId != 0)
        {
            <input type="button" class="btn btn-primary" id="btnExportReport" value="Export to Excel" />
        }
    </div>
</div>
<div class="alert alert-danger @(string.IsNullOrWhiteSpace(ViewBag.ErrorMessage) ? "hidden" : "")">@ViewBag.ErrorMessage</div>
<hr />

<div class="report">
    <div id="errorMsgs" style="color: red"></div>
    <div id="msgs"></div>
    @using (Html.BeginForm("PriceMovement", "PriceReports", FormMethod.Get, new { onkeydown = "return event.keyCode!=13", onsubmit = "return false" }))
    {
        <div class="row">
            <div class="col-md-2">
                <label for="Brand">Brand:</label>
                @Html.DropDownListFor(d => d.Brand, Model.Brands.Select(b => new SelectListItem { Value = b, Text = b, Selected = b == Model.Brand }), null, new { @class = "form-control" })
            </div>
            <div class="col-md-2">
                <label for="DateFrom">From:</label>
                <input type="text" class="datepicker form-control" id="DateFrom" name="dateFrom" value='@requestedFromDate'>

            </div>
            <div class="col-md-2">
                <label for="DateTo">To:</label>
                <input type="text" class="datepicker form-control" id="DateTo" name="dateTo" value='@requestedToDate'>

            </div>
            <div class="col-md-2">
                <label for="FuelTypeId">Fuel:</label>
                @Html.DropDownListFor(d => d.FuelTypeId, Model.FuelTypes.Select(b => new SelectListItem { Value = b.Key.ToString(), Text = b.Value, Selected = b.Key == Model.FuelTypeId }), null, new { @class = "form-control" })
            </div>
            <div class="col-md-1" style="padding-top: 24px">
                <input type="button" value="View" class="btn btn-success" id="btnViewReport" />
            </div>
        </div>
    }

    @if (Model.FuelTypeId > 0)
    {
        <hr />
        <h4>
            @Model.Brand price movement of @Model.FuelTypeName
            From: @Model.FromDate.Value.ToString("dd-MMM-yyyy") - To: @Model.ToDate.Value.ToString("dd-MMM-yyyy")
        </h4>

        <!-- Report Data -->
        <table class="table table-hover table-responsive table-striped">
            <thead>
                <tr>
                    <th>Sites</th>

                    @if (!Model.PriceMovementReport.ReportRows.First().DataItems.Any())
                    {
                        <th>Status</th>
                    }
                    else
                    {
                        foreach (var date in Model.PriceMovementReport.ReportRows.First().DataItems.Select(x => x.PriceDate))
                        {
                            <th>@(date.ToString("dd-MMM-yy"))</th>
                        }
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var siteRow in Model.PriceMovementReport.ReportRows)
                {
                    <tr>
                        <td>
                            @siteRow.SiteName
                        </td>
                        @if (!siteRow.DataItems.Any())
                        {
                            <td>There is no data available</td>
                        }
                        @foreach (var dataItem in siteRow.DataItems)
                        {
                            <td>@(  (dataItem.PriceValue / 10.0).ToString("###0.0"))</td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

@section scripts {
    <script src="~/Scripts/bootstrap-datepicker.min.js"></script>
    <script src="~/Scripts/PriceReports/priceMovement.js"></script>
}