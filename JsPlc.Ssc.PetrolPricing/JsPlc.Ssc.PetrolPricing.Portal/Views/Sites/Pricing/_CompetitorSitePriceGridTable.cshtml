@using JsPlc.Ssc.PetrolPricing.Models
@model JsPlc.Ssc.PetrolPricing.Models.SiteViewModel


<div data-bind="with: $root.dataModel, visible: !$root.busyLoadingData()">
    <!-- ko foreach: sites -->
    <div data-bind="attr:{id: ('AjaxCollapseCompetitorsforsite' + SiteId)}" onclick="IsSitePriceFormClicked=1;" class="panel-collapse collapse" role="tabpanel" style="background-color: grey">
        <div class="compitatorData">
            <table class="competitorTable table-striped table-hover full-width">
                <colgroup>
                    <col width="9%" />
                    <col width="5%" />
                    <col width="20%" />
                    <col width="4%" />
                    <col width="4%" />
                    <col width="4%" />

                    <col width="5%" />
                    <col width="7%" />
                    <col width="6%" />

                    <col width="5%" />
                    <col width="7%" />
                    <col width="6%" />

                    <col width="5%" />
                    <col width="7%" />
                    <col width="6%" />
                </colgroup>

                <thead>
                    <tr class="sainsburys-row">
                        <th></th>
                        <th colspan="5" class="text-right" style="color: #ED8B00;"><big class="storeName"></big>&nbsp;</th>

                        <th class="readonlyUnleadedYesterday tblHighlight text-center">-</th>
                        <th class="readonlyUnleadedToday tblHighlight text-center" colspan="2">-</th>

                        <th class="readonlyDieselYesterday text-center">-</th>
                        <th class="readonlyDieselToday text-center" colspan="2">-</th>

                        <th class="readonlySuperUnleadedYesterday tblHighlight text-center">-</th>
                        <th class="readonlySuperUnleadedToday tblHighlight text-center" colspan="2">-</th>
                    </tr>

                    <tr>
                        <th class="num1"><span>Brand</span></th>
                        <th class="num2"><span>Notes</span></th>
                        <th class="num3"><span>Marker</span></th>
                        <th class="num4"><span>Drive-Time</span></th>
                        <th class="num5"></th>
                        <th class="num6"><span>Cat No.</span></th>

                        <th colspan="3" class="tblHighlight text-center dividerLeft">
                            <h4>
                                <span class="label label-success">
                                    &nbsp;Unleaded&nbsp;
                                </span>
                            </h4>
                        </th>
                        <th colspan="3" class="text-center dividerLeft">
                            <h4>
                                <span class="label label-black">&nbsp;Diesel&nbsp;</span>
                            </h4>
                        </th>
                        <th colspan="3" class="tblHighlight text-center dividerLeft">
                            <h4>
                                <span class="label label-success-inverted">&nbsp;Super Unleaded&nbsp;</span>
                            </h4>
                        </th>
                    </tr>
                    <tr>
                        <th colspan="6"></th>
                        <th class="num7 tblHighlight text-center"><span class="compyday">Yesterday</span></th>
                        <th class="num8 tblHighlight text-center"><span class="comptoday">Today</span></th>
                        <th class="num9 tblHighlight text-center"><span class="jsdiff">JS_Diff</span></th>

                        <th class="num10 text-center"><span class="compyday">Yesterday</span></th>
                        <th class="num11 text-center"><span class="comptoday">Today</span></th>
                        <th class="num12 text-center"><span class="jsdiff">JS_Diff</span></th>

                        <th class="num13 tblHighlight text-center"><span class="compyday">Yesterday</span></th>
                        <th class="num14 tblHighlight text-center"><span class="comptoday">Today</span></th>
                        <th class="num15 tblHighlight text-center"><span class="jsdiff">JS_Diff</span></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko if: loadingCompetitors() -->
                    <tr>
                        <td colspan="15" class="noSiteData text-center"><span class="please-wait"><i class="fa fa-clock-o spinner"></i> Loading... Please wait</span></td>
                    </tr>
                    <!-- /ko -->
                    <!-- ko if: !loadingCompetitors() -->
                    <!-- ko if: !hasCompetitors() -->
                    <tr>
                        <td colspan="15" class="noSiteData text-center"><span class="no-competitors"><i class="fa fa-info-circle"></i> Sorry, no competitors available</span></td>
                    </tr>
                    <!-- /ko -->
                    <!-- ko if: hasCompetitors() -->
                    <!-- ko foreach: competitors -->
                    <tr class="competitor-row hoverable" data-bind="attr:{id:'CompetitorSiteRow_' + SiteId}">
                        <td class="num1"><span data-bind="text: Brand"></span></td>
                        <td class="num2">
                            <button type="button" class="btn btn-default btn-xs triggerEditSiteNote" data-bind="attr:{id: 'EditSiteNoteButton_' + SiteId}" data-infotip="Create or edit note"><i class="fa fa-pencil"></i></button>
                            <button type="button" class="btn btn-default btn-xs triggerToggleNote" data-bind="attr:{id: 'ToggleSiteNoteButton_' + SiteId}" data-infotip="Show Note"><i class="fa fa-sort-up"></i></button>
                        </td>
                        <td class="num3"><span data-bind="text: StoreName"></span></td>
                        <td class="num4"><b class="drive-time-miles"><span data-bind="text: DriveTime, attr: {'data-infotip': 'Drive Time of [b]' + DriveTime + '[/b] Minutes [br /] [q]Unleaded:[/q] [b]+' + DrivePenceForUnleaded + 'p[/b] &mdash; [q]Diesel:[/q] [b]+' + DrivePenceForDiesel + 'p[/b] &mdash; [q]Super-Unleaded:[/q] [b]+' + DrivePenceForSuperUnleaded + 'p[/b]'}"></span></b></td>
                        <td class="num5"></td>
                        <td class="num6"><span data-bind="text: CatNo, attr: {'data-infotip': 'Catalist Number: [b]' + CatNo + '[/b]'}"></span></td>

                        <!-- ko foreach: FuelPricesToDisplay -->
                        <!-- ko if: siteSupportsFuel -->
                        <td style="border-left: 2px solid #666" class="text-center" data-bind="css: (isDriveTimeBoundary() ? 'drive-time-boundary' : '')" >


                            <span data-bind="html: FuelPrice.ForecourtYestPriceHtml(), attr: {'data-infotip': FuelPrice.YestPriceInfotip()}"></span>

                        </td>
                        <td style="border-left: 1px solid #ccc;" data-bind="css: (isDriveTimeBoundary() ? 'drive-time-boundary' : '') + ($parents[1].FuelPricesToDisplay[0].FuelPrice.CompetitorName == $parents[0].Brand + '/' + $parents[0].StoreName  && $parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice >0 && FuelPrice.FuelTypeId==2 ?  'competitor-fuel-unleaded' : $parents[1].FuelPricesToDisplay[1].FuelPrice.CompetitorName == $parents[0].Brand + '/' + $parents[0].StoreName  && $parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice >0 && FuelPrice.FuelTypeId==6? 'competitor-fuel-diesel': $parents[1].FuelPricesToDisplay[2].FuelPrice.CompetitorName == $parents[0].Brand + '/' + $parents[0].StoreName  && $parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice >0 && FuelPrice.FuelTypeId==1? 'competitor-fuel-super-unleaded ' : '')">
                            <div >
                                <span data-bind="html: FuelPrice.ForecourtTodayPriceHtml(), attr: {'data-infotip': FuelPrice.CompTodayPriceInfotip()}"></span>

                                <i data-bind="attr: {class: (FuelPrice.Difference ==0 || FuelPrice.Difference == '-' ) ? 'fa fa-arrow-right' : (FuelPrice.Difference <= 0.1) ? 'fa fa-arrow-down': 'fa fa-arrow-up', style: (FuelPrice.Difference == 0 || FuelPrice.Difference == '-') ? 'color: grey' : (FuelPrice.Difference <= 0.1) ? 'color: red': 'color: green', }"></i>
                                &nbsp;<span data-bind="text: (FuelPrice.Difference == 0 || FuelPrice.Difference == '-') ? '-' : (FuelPrice.Difference/10)"></span>
                            </div>

                        </td>
                        <td style="border-left: 1px solid #ccc;" class="text-center" data-bind="class: (FuelPrice.FuelTypeId==2 ? 'diesel-fuel' : ''), css: (isDriveTimeBoundary() ? 'drive-time-boundary' : '')">

                            <div data-bind="if: FuelPrice.FuelTypeId==2">
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  != 'NaN' ">
                                    <span class="comp-js-price-diff" data-bind="text: ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) "></span>
                                    <i data-bind="attr: { css: ( ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) ==0 || ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) =='NaN' ) ? '' : (($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  <= 0.1) ? 'fa fa-minus': 'fa fa-plus', style: (($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  == 0 || ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice ).toFixed(1) == 'NaN') ? 'color: grey' : ( ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice ).toFixed(1)  <= 0.1) ? 'color: red': 'color: green'}"></i>
                                </div>
                                <div class="comp-js-price-diff-na" data-bind="if: ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ">
                                    <span>n/a</span>
                                </div>
                            </div>


                            <div data-bind="if: FuelPrice.FuelTypeId==6" class="text-center">
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  != 'NaN' ">
                                    <span class="comp-js-price-diff" data-bind="text: ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) "></span>
                                    <i data-bind="attr: { css: ( ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) ==0 || ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) =='NaN' ) ? '' : (($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'fa fa-minus': 'fa fa-plus', style: (($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 0  || ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ) ? 'color: grey' :( ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'color: red': 'color: green'}"></i>
                                </div>
                                <div class="comp-js-price-diff-na" data-bind="if: ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ">
                                    <span>n/a</span>
                                </div>
                            </div>

                            <div data-bind="if: FuelPrice.FuelTypeId==1" class="text-center">
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  != 'NaN' ">
                                    <span class="comp-js-price-diff" data-bind="text: ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) "></span>
                                    <i data-bind="attr: { css: ( ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice -FuelPrice.TodayPrice).toFixed(1) ==0 || ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) =='NaN' ) ? '' : (($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'fa fa-minus': 'fa fa-plus', style: (($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 0 || ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN') ? 'color: grey' : ( ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'color: red': 'color: green'}"></i>
                                </div>
                                <div class="comp-js-price-diff-na" data-bind="if: ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ">
                                    <span>n/a</span>
                                </div>
                            </div>
                        </td>
                        <!-- /ko -->
                        <!-- ko if: !siteSupportsFuel -->
                        <td style="border-left: 2px solid #666" colspan="3" data-bind="css: (isDriveTimeBoundary() ? 'drive-time-boundary' : '')">n/a</td>
                        <!-- /ko -->
                        <!-- /ko -->
                    </tr>
                    <tr class="note-row" data-bind="attr:{id:'CompetitorNote_' + SiteId}">
                        <td colspan="15">
                            <div class="note-panel">
                                <p class="note-panel-text" data-bind="formatSiteNote: Notes" data-infotip="Click to edit"></p>
                            </div>
                        </td>
                    </tr>
                    <!-- /ko -->
                    <!-- /ko -->
                    <!-- /ko -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- /ko -->
</div>
