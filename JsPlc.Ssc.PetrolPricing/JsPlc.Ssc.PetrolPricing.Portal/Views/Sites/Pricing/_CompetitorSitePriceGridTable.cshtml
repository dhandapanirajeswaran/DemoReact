@using JsPlc.Ssc.PetrolPricing.Models
@model JsPlc.Ssc.PetrolPricing.Models.SiteViewModel


<div data-bind="with: $root.dataModel, visible: !$root.busyLoadingData()">
    <!-- ko foreach: sites -->
    <div data-bind="attr:{id: ('AjaxCollapseCompetitorsforsite' + SiteId)}" onclick="IsSitePriceFormClicked=1;" class="panel-collapse collapse" role="tabpanel" style="background-color: grey">
        <div class="compitatorData">
            <table class="competitorTable table-striped table-hover full-width">
                <colgroup>
                    <col width="12%" />
                    <col width="6%" />
                    <col width="18%" />
                    <col width="4%" />
                    <col width="4%" />

                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                    <col width="6%" />
                </colgroup>

                <thead>
                    <tr>
                        <th class="num1"><span>Brand</span></th>
                        <th class="num2"><span>Notes</span></th>
                        <th class="num3"><span>Marker</span></th>
                        <th class="num4"><span>Drive-Time</span></th>
                        <th class="num5"><span>Cat No.</span></th>

                        <th colspan="3" class="text-center dividerLeft">
                            <h4>
                                <span class="label label-success">
                                    &nbsp;Unleaded&nbsp;
                                </span>
                            </h4>
                        </th>
                        <th colspan="3" class="text-center dividerLeft">
                            <h4>
                                <span class="label label-black">&nbsp;Diesel&nbsp;</span>
                            </h4>
                        </th>
                        <th colspan="3" class="text-center dividerLeft">
                            <h4>
                                <span class="label label-success-inverted">&nbsp;Super Unleaded&nbsp;</span>
                            </h4>
                        </th>
                    </tr>
                    <tr>
                        <th colspan="5"></th>
                        <th class="num6 tblHighlight"><span class="compyday">Yesterday</span></th>
                        <th class="num7 tblHighlight"><span class="comptoday">Today</span></th>
                        <th class="num8 tblHighlight"><span class="jsdiff">JS_Diff</span></th>
                        <th class="num9"><span class="compyday">Yesterday</span></th>
                        <th class="num10"><span class="comptoday">Today</span></th>
                        <th class="num11"><span class="jsdiff">JS_Diff</span></th>
                        <th class="num12 tblHighlight"><span class="compyday">Yesterday</span></th>
                        <th class="num13 tblHighlight"><span class="comptoday">Today</span></th>
                        <th class="num14 tblHighlight"><span class="jsdiff">JS_Diff</span></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko if: loadingCompetitors() -->
                    <tr>
                        <td colspan="14" class="noSiteData text-center"><span class="please-wait"><i class="fa fa-clock-o spinner"></i> Loading... Please wait</span></td>
                    </tr>
                    <!-- /ko -->
                    <!-- ko if: !loadingCompetitors() -->
                    <!-- ko if: !hasCompetitors() -->
                    <tr>
                        <td colspan="14" class="noSiteData text-center"><span class="no-competitors"><i class="fa fa-info-circle"></i> Sorry, no competitors available</span></td>
                    </tr>
                    <!-- /ko -->
                    <!-- ko if: hasCompetitors() -->
                    <!-- ko foreach: competitors -->
                    <tr class="competitor-row hoverable" data-infotip="Double click to edit/create Site Note" data-bind="attr:{id:'CompetitorSiteRow_' + SiteId}, style: {background : $parent.FuelPricesToDisplay[0].FuelPrice.CompetitorName == Brand + '/' + StoreName  && $parent.FuelPricesToDisplay[0].FuelPrice.AutoPrice >0 ?  'yellow' : 'lightgray'}">
                        <td class="num1"><span data-bind="text: Brand"></span></td>
                        <td class="num2">
                            <button type="button" class="btn btn-default btn-xs triggerEditSiteNote" data-bind="attr:{id: 'EditSiteNoteButton_' + SiteId}" data-infotip="Create or edit note"><i class="fa fa-pencil"></i></button>
                            <button type="button" class="btn btn-default btn-xs triggerToggleNote" data-bind="attr:{id: 'ToggleSiteNoteButton_' + SiteId}" data-infotip="Show Note"><i class="fa fa-sort-up"></i></button>
                        </td>
                        <td class="num3"><span data-bind="text: StoreName"></span></td>
                        <td class="num4"><b><span data-bind="text: DriveTime"></span></b></td>
                        <td class="num5"><span data-bind="text: CatNo"></span></td>

                        <!-- ko foreach: FuelPricesToDisplay -->
                        <!-- ko if: siteSupportsFuel -->
                        <td style="border-left: 1px solid #ccc"><span data-bind="text: FuelPrice.YestPrice"></span></td>
                        <td style="border-left: 1px solid #ccc;">
                            <span data-bind="text: FuelPrice.TodayPrice"></span>

                            <i data-bind="attr: {css: (FuelPrice.Difference ==0 || FuelPrice.Difference == '-' ) ? 'fa fa-arrow-circle-o-right' : (FuelPrice.Difference <= 0.1) ? 'fa fa-arrow-circle-o-down': 'fa fa-arrow-circle-o-up', style: (FuelPrice.Difference == 0 || FuelPrice.Difference == '-') ? 'color: grey' : (FuelPrice.Difference <= 0.1) ? 'color: red': 'color: green', }"></i>
                            &nbsp;<span data-bind="text: (FuelPrice.Difference == 0 || FuelPrice.Difference == '-') ? '-' : (FuelPrice.Difference/10)"></span>


                        </td>
                        <td style="border-left: 1px solid #ccc;">

                            <div data-bind="if: FuelPrice.FuelTypeId==2">
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  != 'NaN' ">
                                    <span data-bind="text: ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) "></span>
                                    <i data-bind="attr: { css: ( ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) ==0 || ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) =='NaN' ) ? '' : (($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  <= 0.1) ? 'fa fa-minus': 'fa fa-plus', style: (($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  == 0 || ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice ).toFixed(1) == 'NaN') ? 'color: grey' : ( ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice ).toFixed(1)  <= 0.1) ? 'color: red': 'color: green'}"></i>
                                </div>
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[0].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ">
                                    <span>n/a</span>
                                </div>
                            </div>

                            <div data-bind="if: FuelPrice.FuelTypeId==6">
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  != 'NaN' ">
                                    <span data-bind="text: ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) "></span>
                                    <i data-bind="attr: { css: ( ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) ==0 || ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) =='NaN' ) ? '' : (($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'fa fa-minus': 'fa fa-plus', style: (($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 0  || ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ) ? 'color: grey' :( ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'color: red': 'color: green'}"></i>
                                </div>
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[1].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ">
                                    <span>n/a</span>
                                </div>
                            </div>

                            <div data-bind="if: FuelPrice.FuelTypeId==1">
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1)  != 'NaN' ">
                                    <span data-bind="text: ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) "></span>
                                    <i data-bind="attr: { css: ( ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice -FuelPrice.TodayPrice).toFixed(1) ==0 || ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) =='NaN' ) ? '' : (($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'fa fa-minus': 'fa fa-plus', style: (($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 0 || ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN') ? 'color: grey' : ( ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) <= 0.1) ? 'color: red': 'color: green'}"></i>
                                </div>
                                <div data-bind="if: ($parents[1].FuelPricesToDisplay[2].FuelPrice.AutoPrice - FuelPrice.TodayPrice).toFixed(1) == 'NaN' ">
                                    <span>n/a</span>
                                </div>

                            </div>
                        </td>
                        <!-- /ko -->
                        <!-- ko if: !siteSupportsFuel -->
                        <td style="border-left: 1px solid #ccc" colspan="3">n/a</td>
                        <!-- /ko -->
                        <!-- /ko -->
                    </tr>
                    <tr class="note-row" data-bind="attr:{id:'CompetitorNote_' + SiteId}">
                        <td colspan="14">
                            <div class="note-panel">
                                <p class="note-panel-text" data-bind="formatSiteNote: Notes" data-infotip="Click to edit"></p>
                            </div>
                        </td>
                    </tr>
                    <!-- /ko -->
                    <!-- /ko -->
                    <!-- /ko -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- /ko -->
</div>
