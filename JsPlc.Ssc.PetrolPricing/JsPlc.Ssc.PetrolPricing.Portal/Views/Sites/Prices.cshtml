@{
    ViewBag.Title = "Site Prices";
}
<!-- Modal -->
<form id="myform" method="post" action="sites/prices">
    <div class="modal fade" id="emailSite" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Send Email</h4>
                </div>
                <div class="modal-body">
                    <h1>FAO Store/duty manager - URGENT FUEL PRICE CHANGE</h1>
                    <p>Queries to the Trading Hotline using Option 1 Trading, Option 2 Grocery and Option 8 Petrol and Kiosk </p>
                    <h2>kSiteName</h2>
                    <p><strong>Petrol price changes, effective end of trade kStartDateMonthYear</strong></p>
                    <table>
                        <tr><td><strong>Product</strong></td><td><strong>New Price</strong></td></tr>
                        <tr><td>Unleaded</td><td>kUnleadedPrice</td></tr>
                        <tr><td>Super (if applicable)</td><td>kSuperPrice</td></tr>
                        <tr><td>Diesel</td><td>kDieselPrice</td></tr>
                    </table>
                    <br />
                    <ul>
                        <li>All fuel price changes must be actioned at the end of trade only</li>
                        <li>Colleague actioning the price change must ensure the changes have applied on the pumps, enter the time of the change and then sign as confirmation before filing this message at the PFS</li>
                        <li>Ensure you enter the new prices correctly into REPOS e.g. If the price is 129.90ppl, then enter 129.90 in the new price field (make sure there are no fuel sales outstanding on the REPOS system or pumps before making the price change, <strong>ALL</strong> working pumps <strong>MUST</strong> be left <strong>ON</strong> and nozzle placed in the pump holders)</li>
                        <li>You are reminded that only fuel price changes sent to you by email should be actioned. Please ignore REPOS price change reports.</li>
                    </ul>
                    <h3>24 hour sites</h3>
                    <ul>
                        <li>Action the price change in conjunction with the REPOS EOD routine between midnight and 2am. Colleague actioning the price change must ensure that the changes have applied on the pumps, enter the time of the change and then sign as confirmation before filing this message at the PFS.</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <!--<button type="submit" class="btn btn-default">Email Site</button>-->

                    <input type="submit" class="btn btn-default" value="Email Site" />
                </div>
            </div>
        </div>
    </div>
</form>

<form id="myform" method="post" action="emailAllSites">
    <div class="modal fade" id="emailAllSites" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Send Email to ALL Sites</h4>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to email <strong>ALL</strong> Sites their daily price update</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-default">Email All Sites</button>
                </div>
            </div>
        </div>
    </div>
</form>

<h2>Site Prices</h2>

<!-- knockout binds here -->
<div class="container" id="petrolpricingpage">
    <div id="msgs"></div>
    <!-- Submit disabled, all work done thru ajax calls -->
    <form id="myform" method="post" data-bind="submit: savePetrolPricingForm" xclass="input-group-sm" onsubmit="return false;">
        <div style="width:100%;text-align:right;margin-top:-20px;">
            <!-- EMAIL all Button -->
            <button type="button" class="btn btn-default" data-toggle="modal" data-target="#emailAllSites">Email all &nbsp;<i class="fa fa-envelope-o"></i></button>
        </div>
        <span>Market Comparison: Sainsburys's prices and Competitors</span><br />
        <hr />
        <div class="row">
            <div class="col-md-9">
                <!-- Date Picker -->
                <div class="col-md-2"><b>Select Date:</b></div>
                <div class="col-md-2 left">
                    <input type="text" id="viewingDate" class="datepicker form-control"
                           style="background-color: #ececec; width: 100px" name="viewingDate" width="200" 
                           data-bind="value: $root.InitDate"/>
                </div>
                <div class="col-md-2 left"><button type="submit" class="btn btn-default" data-bind="click: loadNewDateData">Go</button></div>
            </div>
            <div class="col-md-3 right">
                <button type="submit" class="btn btn-default" data-bind="click: savePetrolPricingForm, visible: $root.ShowSaveButton">Save Prices</button>
                <div id="unSavedChangesMsg" data-bind="visible: $root.HasUnsavedChanges" style="color: brown; font-size: larger">You have unsaved changes</div>
            </div>
        </div>
        <hr />
        <div class="table-responsive">
            <table class="table table-striped table-hover" id="accordion">
                <!-- HEADINGS -->
                <thead>
                    <!-- 11 column layout -->
                    <tr rowspan="2" style="background-color: silver">
                        <th colspan="1"><span>#</span></th>

                        <th><span>Store No.</span></th>
                        <th><span></span></th>
                        <th><span>Store Name</span></th>
                        <th><span>Cat No.</span></th>
                        <th><span>PFS No.</span></th>

                        <th colspan="2"><span class="fuelHeaderGroup">&nbsp;Unleaded&nbsp;</span></th>
                        <th colspan="2"><span class="fuelHeaderGroup">&nbsp;Diesel&nbsp;</span></th>
                        <th colspan="2"><span class="fuelHeaderGroup">&nbsp;LPG&nbsp;</span></th>
                    </tr>
                    <tr>
                        <th colspan="6"></th>
                        <th><span>Today</span></th>
                        <th><span>Tomorrow</span></th>
                        <th><span>Today</span></th>
                        <th><span>Tomorrow</span></th>
                        <th><span>Today</span></th>
                        <th><span>Tomorrow</span></th>
                    </tr>
                </thead>
                <tbody data-bind="with: dataModel">
                    <!-- JS Store DataRows -->
                    <!-- ko foreach: sites -->
                    <tr class="panel-heading" role="tab" data-bind="id:('Heading' + SiteId)">
                        <td>
                            <a role="button" data-toggle="collapse" data-parent="#accordion"
                               data-bind="attr:{href:('#CollapseCompetitorsforsite' + SiteId)}, click: getCompetitorDataClick"><i class="fa fa-plus-square-o"></i></a>
                        </td>
                        <td><span data-bind="text: StoreNo"></span></td>
                        <td><span><a href="#" data-toggle="modal" data-target="#emailSite"><i class="fa fa-envelope-o"></i></a></span></td>
                        <td><span data-bind="text: StoreName"></span></td>
                        <td><span data-bind="text: CatNo"></span></td>
                        <td><span data-bind="text: PfsNo"></span></td>

                        <!-- ko foreach: FuelPricesToDisplay -->
                        <!-- ko if: siteSupportsFuel -->
                        <td>
                            <span data-bind="text: FuelPrice.TodayPrice"></span>
                        </td>
                        <td>
                            <i class="fa fa-arrow-circle-o-down" style="color: red; font-size: 100%;"></i>
                            &nbsp;<span data-bind="text: FuelPrice.AutoPrice"></span>
                            <input type="text" data-bind="value: FuelPrice.OverridePrice,
                                id: ($parent.SiteId + '-' + FuelPrice.FuelTypeId + '-overridePrice'), event:{keyup: FuelPrice.changeProp}" class="txtPrice" />
                            <!-- note: override prices can be extracted using $('#SiteId-FueldTypeId-overridePrice') -->
                        </td>
                        <!-- /ko -->
                        <!-- ko if: !siteSupportsFuel -->
                        <td colspan="2">n/a</td>
                        <!-- /ko -->
                        <!-- /ko -->
                    </tr>
                    <tr data-bind="attr:{id: ('AjaxCollapseCompetitorsforsite' + SiteId)}" class="panel-collapse collapse" role="tabpanel">
                        <td colspan="12" xalign="right" style="background-color: grey">
                            <table class="competitorTable table-striped table-hover">
                                <thead>
                                    <tr rowspan="2">
                                        <th><span>Brand</span></th>
                                        <th><span>Marker</span></th>
                                        <th><span>Drive-Time</span></th>
                                        <th><span>Cat No.</span></th>

                                        <th colspan="2" class="tblHighlight">
                                            <span class="fuelHeaderGroup">&nbsp;Unleaded&nbsp;</span>
                                        </th>
                                        <th colspan="2"><span class="fuelHeaderGroup">&nbsp;Diesel&nbsp;</span></th>
                                        <th colspan="2" class="tblHighlight"><span class="fuelHeaderGroup">&nbsp;LPG&nbsp;</span></th>
                                    </tr>
                                    <tr>
                                        <th colspan="4"></th>
                                        <th class="tblHighlight"><span>Yesterday</span></th>
                                        <th class="tblHighlight"><span>Today</span></th>
                                        <th><span>Yesterday</span></th>
                                        <th><span>Today</span></th>
                                        <th class="tblHighlight"><span>Yesterday</span></th>
                                        <th class="tblHighlight"><span>Today</span></th>

                                    </tr>
                                </thead>
                                <!-- ko if: hasCompetitors -->
                                <tbody>
                                    <!-- ko foreach: competitors -->
                                    <tr>
                                        <td><span data-bind="text: Brand"></span></td>
                                        <td><span data-bind="text: StoreName"></span></td>
                                        <td><span data-bind="text: DriveTime"></span></td>
                                        <td><span data-bind="text: CatNo"></span></td>

                                        <!-- ko foreach: FuelPricesToDisplay -->
                                        <!-- ko if: siteSupportsFuel -->
                                            <td><span data-bind="text: FuelPrice.YestPrice"></span></td>
                                            <td class="tblHighlight"><span data-bind="text: FuelPrice.TodayPrice"></span></td>
                                        <!-- /ko -->
                                        <!-- ko if: !siteSupportsFuel -->
                                        <td colspan="2">n/a</td>
                                        <!-- /ko -->
                                        <!-- /ko -->
                                    </tr>
                                    <!-- /ko -->
                                </tbody>
                                <!-- /ko -->
                                <!-- ko if: !hasCompetitors -->
                                <tbody data-bind="visible: (!hasCompetitors)" xstyle="visibility: hidden; display: none">
                                    <tr>
                                        <td colspan="10" class="noSiteData">Sorry, no competitors available</td>
                                    </tr>
                                </tbody>
                                <!-- /ko -->
                            </table>
                        </td>
                    </tr>
                    <!-- /ko -->
                </tbody>
                <tbody data-bind="cvisible: !$root.dataAvailable" style="visibility: hidden; display: none">
                    <tr>
                        <td colspan="10" class="noSiteData">Sorry, no site data available</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </form>
</div>

<br />

<script type="text/javascript">
    require(["SitePricing"]);
</script>
