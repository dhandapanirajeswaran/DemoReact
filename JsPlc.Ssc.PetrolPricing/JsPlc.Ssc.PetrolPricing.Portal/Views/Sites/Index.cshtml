@model IEnumerable<JsPlc.Ssc.PetrolPricing.Models.Site>
@{
    ViewBag.Title = "Sainsbury's sites";

    var activeSiteCount = 0;
    var inactiveSiteCount = 0;
    var totalSiteCount = 0;
    var trialPriceSiteCount = 0;
    var matchCompetitorSiteCount = 0;
    var standardSiteCount = 0;
    var hasEmailSiteCount = 0;
    var hasNoEmailSiteCount = 0;
    var hasDataCount = 0;
    var missingDataCount = 0;

    if (Model != null)
    {
        foreach (var site in Model)
        {
            if (site.IsActive)
            {
                activeSiteCount++;
            }
            else
            {
                inactiveSiteCount++;
            }

            if (site.TrailPriceCompetitorId.HasValue)
            {
                matchCompetitorSiteCount++;
            }
            else if (site.CompetitorPriceOffset != 0)
            {
                trialPriceSiteCount++;
            }
            else
            {
                standardSiteCount++;
            }

            if (site.Emails != null && site.Emails.Count() > 0)
            {
                hasEmailSiteCount++;
            }
            else
            {
                hasNoEmailSiteCount++;
            }
            if (site.CatNo.HasValue && site.CatNo > 0 && site.StoreNo.HasValue && site.StoreNo > 0)
            {
                hasDataCount++;
            } else
            {
                missingDataCount++;
            }

            totalSiteCount++;
        }
    }
}

<style>
    .match-competitor-price,
    .trial-price,
    .standard-price {
        color: #ccc;
    }

    .highlight-match-competitors .match-competitor-price {
        background-color: #cff;
        color: #000;
    }

    .highlight-trial-prices .trial-price {
        background-color: #ff8;
        color: #000;
    }

    .highlight-standard-prices .standard-price {
        background-color: #cfc;
        color: #000;
    }

    .table.site-grid thead th:nth-child(1),
    .table.site-grid tbody td:nth-child(1) {
        width: 6%;
    }

    .table.site-grid thead th:nth-child(2),
    .table.site-grid tbody td:nth-child(2) {
        width: 8%;
    }

    .table.site-grid thead th:nth-child(3),
    .table.site-grid tbody td:nth-child(3) {
        width: 8%;
    }

    .table.site-grid thead th:nth-child(4),
    .table.site-grid tbody td:nth-child(4) {
        width: 8%;
    }

    .table.site-grid thead th:nth-child(5),
    .table.site-grid tbody td:nth-child(5) {
        width: 20%;
    }

    .table.site-grid thead th:nth-child(6),
    .table.site-grid tbody td:nth-child(6) {
        width: 14%;
    }

    .table.site-grid thead th:nth-child(7),
    .table.site-grid tbody td:nth-child(7) {
        width: 6%;
    }

    .table.site-grid thead th:nth-child(8),
    .table.site-grid tbody td:nth-child(8) {
        width: 12%;
    }

    .table.site-grid thead th:nth-child(9),
    .table.site-grid tbody td:nth-child(9) {
        width: 5%;
    }

    .table.site-grid thead th:nth-child(10),
    .table.site-grid tbody td:nth-child(10) {
        width: 10%;
    }

    .table.site-grid .match-competitor-price {
        display: block;
        font-variant: small-caps;
    }

    .table.site-grid .standard-price {
        display: block;
        font-variant: small-caps;
    }

    .table.site-grid .trial-price {
        display: block;
        font-variant: small-caps;
    }

    table.site-email-grid .column-1 {
        width: 9%;
    }

    table.site-email-grid .column-2 {
        width: 9%;
    }

    table.site-email-grid .column-3 {
        width: 8%;
    }

    table.site-email-grid .column-4 {
        width: 28%;
    }

    table.site-email-grid .column-5 {
        width: 10%;
    }

    table.site-email-grid .column-6 {
        width: 6%;
    }

    table.site-email-grid .column-7 {
        width: 5%;
    }

    table.site-email-grid .column-8 {
        width: 25%;
    }

    table.table.site-grid th,
    table.table.site-grid td {
        padding-left: 4px;
        padding-right: 4px;
    }

    table.site-email-grid thead th { height: auto; padding: 0.5em; background-color: #666; color: #fff; border-right: 1px solid #fff;}
    table.site-email-grid thead {width: 1152px;}
</style>

<div class="row">
    <div class="col-md-6">
        <h1><i class="fa fa-gear"></i> Sainsbury's sites</h1>
    </div>
    <div class="col-md-6 text-right" style="padding-top: 20px">
        <a class="btn btn-primary" href="@Url.Action("SiteEmails", "Sites")"><i class="fa fa-at"></i> Site Emails...</a>

        <button type="button" onclick="location.href='@Url.Action("Create", "Sites" )'" class="btn btn-primary" data-infotip="Create a New Sainsbury's site'"><i class="fa fa-star"></i> New Sainsbury's site</button>
    </div>
</div>

<div style="display:none;" class="alert alert-warning busy-loader" data-bind="visible: $root.dataLoading()">
    <div class="col-md-1 text-center">
        <i class="fa fa-clock-o fa-2x spinner"></i>
    </div>
    <div class="col-md-10 text-center">
        <strong>Loading Site Maintenance information. Please wait...</strong>
    </div>
    <div class="clearfix"></div>
</div>

<div class="alert alert-info @(string.IsNullOrWhiteSpace(ViewBag.Message) ? "hidden" : "")">@ViewBag.Message</div>
<!-- Approx 300 Sainsbury's sites -->
<hr />
<div class="row">

    <!-- Catalist No -->
    <div class="col-md-2">
        <label for="viewingCatNo">Catalist no:</label>
        <input type="text" id="viewingCatNo" class="form-control"
               name="viewingCatNo" maxlength="9" data-bind="numeric, value: $root.CatNo" />
    </div>
    <!-- Store No -->
    <div class="col-md-2">
        <label for="viewingStoreNo">Store no:</label>
        <input type="text" id="viewingStoreNo" class="form-control"
               name="viewingStoreNo" maxlength="9" data-bind="numeric, value: $root.StoreNo" />
    </div>

    <!-- Store Name -->
    <div class="col-md-2">
        <label for="viewingStoreName">Store name:</label>
        <input type="text" id="viewingStoreName" class="form-control" maxlength="50"
               name="viewingStoreName" data-bind="value: $root.StoreName" />
    </div>
    <!-- Store Town -->
    <div class="col-md-2">
        <label for="viewingStoreTown">Town:</label>
        <input type="text" id="viewingStoreTown" class="form-control" maxlength="50"
               name="viewingStoreTown" data-bind="value: $root.StoreTown" />
    </div>

    <div class="col-md-1 newline">
        <button id="btnGo" type="button" class="btn btn-success" data-bind="click: searchSainsburysStores" data-infotip="Search the [b]Sites[/b]">Go</button>
    </div>

    <div class="col-md-3 newline">
        <button type="button" class="btn btn-warning" data-infotip="Clear the [b]Site[/b] filters" data-bind="click: function() { reloadSearchPage('Sites') }"><i class="fa fa-eraser"></i></button>
    </div>
</div>
<hr />
@if (Model == null)
{
    <div class="row font125pc">
        <div class="alert alert-warning">
            <i class="fa fa-warning"></i>
            <span class="text-center">
                There are no Sites loaded into the system &mdash; Please upload a <strong>Quarterly Data File</strong> <a class="btn btn-primary pull-right" href="@Url.Action("Upload", "File")/?UploadType=QuarterlySiteData" data-infotip="Upload a [b]Quarterly Data File[/b]"><i class="fa fa-upload"></i> Upload...</a>
            </span>
        </div>
    </div>
}

@if (Model != null)
{
    <div class="row">
        <div class="col-md-4">
            <label>Highlight:</label><br />
            <div class="btn-group">
                <button id="btnToggleHighlightTrialPriceSites" type="button" class="btn btn-sm btn-default" data-infotip="Toggle [b]Trial Price[/b] Sites Highlighting"><i class="fa fa-flask"></i> Trial <span class="badge">@(trialPriceSiteCount)</span></button>
                <button id="btnToggleHighlightMatchCompetitors" type="button" class="btn btn-sm btn-default" data-infotip="Toggle [b]Match Competitor[/b] Highlighting"><i class="fa fa-clone"></i> Match <span class="badge">@(matchCompetitorSiteCount)</span> </button>
                <button id="btnToggleHighlightStandardPrices" type="button" class="btn btn-sm btn-default" data-infotip="Toggle [b]Standard Price[/b] Highlighting"><i class="fa fa-dot-circle-o"></i> Standard <span class="badge">@(standardSiteCount)</span></button>
            </div>
            <button id="btnResetHighlighting" type="button" style="display: none;" class="btn btn-sm btn-warning" data-infotip="Remove [b]All[/b] Highlighting"><i class="fa fa-eraser"></i></button>
        </div>

        <div class="col-md-8">
            <label>Show:</label><br />
            <div class="btn-group" data-choose-one-group="data-choose-group" style="margin-right: 1em;">
                <button id="btnShowWithData" type="button" class="btn btn-sm btn-default" data-infotip="Show or Hide sites [b]With Data[/b]"><i class="fa fa-plus-square"></i> Data <span class="badge">@(hasDataCount)</span></button>
                <button id="btnShowMissingData" type="button" class="btn btn-sm btn-default" data-infotip="Show or Hide [b]Missing Data[/b]"><i class="fa fa-square"></i> Missing <span class="badge">@(missingDataCount)</span></button>
            </div>
            <div class="btn-group" data-choose-one-group="email-choose-group" style="margin-right: 1em;">
                <button id="btnShowWithEmails" type="button" class="btn btn-sm btn-default" data-infotip="Show or Hide the Sites [b]with[/b] Emails"><i class="fa fa-at"></i> With Emails <span class="badge">@(hasEmailSiteCount)</span></button>
                <button id="btnShowNoEmails" type="button" class="btn btn-sm btn-default" data-infotip="Show or Hide the Sites with [em]NO[/em] Emails"><i class="fa fa-times"></i> No Emails <span class="badge">@(hasNoEmailSiteCount)</span> </button>
            </div>
            <div class="btn-group" data-choose-one-group="active-choose-group" style="margin-right: 1em;">
                <button id="btnShowActiveSites" type="button" class="btn btn-sm btn-default" data-infotip="Show or Hide the [b]Active[/b] Sites"><i class="fa fa-square"></i> Active <span class="badge">@(activeSiteCount)</span></button>
                <button id="btnShowInActiveSites" type="button" class="btn btn-sm btn-default" data-infotip="Show or Hide the [b]In-active[/b] Sites"><i class="fa fa-square-o"></i> Inactive <span class="badge">@(inactiveSiteCount)</span></button>
            </div>
            <button id="btnResetActiveSites" type="button" style="display: none;" class="btn btn-sm btn-warning" data-infotip="Show [b]All[/b] the Sites"><i class="fa fa-eraser "></i></button>
        </div>
    </div>
    <br />
    <hr />

    <div style="display: none;" id="divNoResultsAlert" class="alert alert-info">
        <p class="text-center font125pc">
            There are 0 site matches. You could try to <span id="btnResetActiveFilters" class="btn btn-danger btn-sm" href="#"><i class="fa fa-eraser"></i> Clear</span> the filters or  change your search criteria, or, <a href="@Url.Action("Index", "Sites")" class="btn btn-success btn-sm"><i class="fa fa-eraser"></i> Reset</a> the Search Criteria.
        </p>
    </div>

    <div class="loading-js alert alert-info">
        <div class="row">
            <div class="col-md-1 text-center">
                <i class="fa fa-clock-o fa-2x spinner"></i>
            </div>
            <div class="col-md-11 text-center">
                <strong>Loading Site Maintenance information. Please wait...</strong>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>

    <div class="wait-for-js">
        @Html.Partial("_SiteList", Model)
    </div>
}

<input type="hidden" id="hdnActiveSitesCount" value="@(activeSiteCount)" />
<input type="hidden" id="hdnInactiveSitesCount" value="@(inactiveSiteCount)" />
<input type="hidden" id="hdnTrialSitesCount" value="@(trialPriceSiteCount)" />
<input type="hidden" id="hdnMatchCompetitorSitesCount" value="@(matchCompetitorSiteCount)" />
<input type="hidden" id="hdnStandardPriceSitesCount" value="@(standardSiteCount)" />
<input type="hidden" id="hdnHasEmailsSiteCount" value="@(hasEmailSiteCount)" />
<input type="hidden" id="hdnHasNoEmailsSiteCount" value="@(hasNoEmailSiteCount)" />
<input type="hidden" id="hdnHasDataSitesCount" value="@(hasDataCount)" />
<input type="hidden" id="hdnMissingDataSitesCount" value="@(missingDataCount)" />

<script type="text/javascript">
    require(["SiteMaintenance"],
        function (sitemaintenance) { }
    );
</script>